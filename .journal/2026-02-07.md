# Journal Entry - 2026-02-07

## 14:30 - Panel Component Fixes: Position Prop and Z-Index Stacking

### Core Issue
The `inspect-panel` custom element had two related problems in the Astro Starlight documentation site:
1. The `position` attribute had no effect - the panel always rendered at the default position
2. When opened, the panel's top section was covered by Starlight's navbar due to z-index stacking context issues

### Root Cause Analysis

**Position Issue**: The wrapper component (`InspectPanel.svelte`) passed a `position` prop to `Inspect.Panel`, but the underlying `svelte-inspect-value` Panel component expects an `align` prop with a different format:
- Wrapper received: `'bottom-right'` (y-x format)
- Panel expected: `'right bottom'` (x-y format)

Since `position` wasn't a recognized prop, it fell through to `...rest` and was ignored, causing the panel to always use the default `align='right full'`.

**Z-Index Issue**: Starlight's `.main-pane` element has `isolation: isolate` (in `TwoColumnContent.astro:17`), which creates a new stacking context. The panel's default z-index of 1000 was being scoped to this context, making it effectively z-index auto/0 relative to the navbar's z-index 10.

### Options Considered

1. **For Position**:
   - Option A: Change the public API to use `align` directly (breaking change)
   - Option B: Map `position` values to `align` format internally (chosen)

2. **For Z-Index**:
   - Option A: Use CSS `contain: layout` to break out of stacking context (complex, may have side effects)
   - Option B: Increase z-index to escape the stacking context (chosen - simpler, explicit)
   - Option C: Use `position: fixed` with `transform: translateZ(0)` hack (hacky, unclear intent)

### Final Decision & Rationale

**Position**: Added a `$derived` value that converts position format:
```typescript
let align = $derived.by(() => {
  if (!position) return 'right full';
  const parts = position.split('-');
  if (parts.length === 2) {
    return `${parts[1]} ${parts[0]}`;  // 'bottom-right' â†’ 'right bottom'
  }
  return position;
});
```

This maintains backward compatibility with the existing `position` API while correctly mapping to the underlying `align` prop.

**Z-Index**: Added a `zIndex` prop defaulting to `9999`. This is high enough to escape most stacking contexts (including Starlight's) while remaining below common system UI levels. The prop is exposed so consumers can override if needed.

### Key Changes Made

| File | Change |
|------|--------|
| `src/InspectPanel.svelte` | Added `zIndex` prop (default 9999), added `align` derived value, changed Panel prop from `position` to `align` |
| `src/types.ts` | Added `zIndex?: number` to `InspectPanelAttributes` |
| `scripts/resolve-types.mjs` | Added `zIndex` to generated type definitions |

### Future Considerations

- The z-index of 9999 should handle most documentation site layouts, but if users embed the panel in other contexts with even higher z-index elements, they can override via the `zIndex` attribute
- Consider documenting the position format more explicitly (`'bottom-right'`, `'top-left'`, etc.)
- The position-to-align mapping only handles the 4 cardinal combinations; edge cases like `'center'` fall through to passthrough behavior
